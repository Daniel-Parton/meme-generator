var t=Object.defineProperty,e=(e,i,s)=>(((e,i,s)=>{i in e?t(e,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[i]=s})(e,"symbol"!=typeof i?i+"":i,s),s);import{P as i}from"./phaser.39311b5c.js";!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver((t=>{for(const i of t)if("childList"===i.type)for(const t of i.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)})).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerpolicy&&(e.referrerPolicy=t.referrerpolicy),"use-credentials"===t.crossorigin?e.credentials="include":"anonymous"===t.crossorigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();class s extends Phaser.Scene{constructor(){super("Boot")}preload(){this.load.setPath("./assets")}create(){this.scene.start("Preload")}}class a extends Phaser.Scene{constructor(){super("Preload")}preload(){this.load.setPath("./assets"),this.load.image("rotate-btn","rotate-btn.png"),this.load.image("bg-woman-yelling-at-cat","bg-woman-yelling-at-cat.jpg"),this.load.image("sunglasses","item-deal-with-it-sunglasses.svg")}create(){this.scene.start("Play")}loadAudio(t){this.load.audio(t,[".mp3",".ogg",".m4a"].map((e=>`${t}${e}`)))}}const h="ItemSelected",r="ItemUnSelected";let n=(t=21)=>{let e="",i=crypto.getRandomValues(new Uint8Array(t));for(;t--;)e+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[63&i[t]];return e};const o=t=>Phaser.Display.Color.HexStringToColor(t),d={select:o("#0058E4"),white:o("#FFFFFF"),black:o("#000000"),gray:o("#696969")},l=(t,e)=>t.height===e.height&&t.width===e.width,g=t=>{const e={...t.size};return e.width>=e.height?(c(e,t.maxWidth||t.max),u(e,t.maxHeight||t.max)):(u(e,t.maxHeight||t.max),c(e,t.maxWidth||t.max)),t.roundToInteger?{height:Math.round(e.height),width:Math.round(e.width)}:e},c=(t,e)=>{e&&t.width>e&&(t.height=f(t,e),t.width=e)},u=(t,e)=>{e&&t.height>e&&(t.width=m(t,e),t.height=e)},f=(t,e)=>e*(t.height/t.width),m=(t,e)=>e*(t.width/t.height);class p extends Phaser.GameObjects.Rectangle{constructor(t,i,s=0){super(t,0,0),e(this,"target"),e(this,"offset"),e(this,"targetData"),this.setAlpha(0),this.offset=s,this.target=i,t.add.existing(this),this.init()}init(){this.setOrigin(0,0),this.setStrokeStyle(1.5,d.select.color,1),this.scene.events.on(h,this.handleItemSelected,this),this.scene.events.on(r,this.handleItemUnSelected,this),this.target.onHover(this.handleTargetHover,this),this.target.onHoverLeave(this.handleTargetHoverLeave,this)}show(){this.setLastTargetData(),this.updateSizeAndAngle(),this.updatePosition(),this.target.onBoundsChanged(this.updatePosition,this),this.animate({alpha:1})}hide(){this.target.offBoundsChange(this.updatePosition),this.animate({alpha:0})}handleItemSelected(t){t.name===this.target.name?this.scene.children.bringToTop(this):this.handleItemUnSelected()}handleItemUnSelected(){const t=this.scene.input.activePointer;this.alpha>0&&!this.target.getBounds().contains(t.x,t.y)&&this.hide()}handleTargetHover(){this.alpha||this.show()}handleTargetHoverLeave(){this.alpha&&!this.target.isSelected&&this.hide()}updatePosition(){l(this.targetData,{width:this.target.displayWidth,height:this.target.displayHeight})&&this.target.angle===this.targetData.angle||(this.setLastTargetData(),this.updateSizeAndAngle());const t=this.target.getTopLeft();this.setPosition(t.x+this.targetData.xOffset,t.y+this.targetData.yOffset)}updateSizeAndAngle(){const t=this.targetData.width+2*this.offset,e=this.targetData.height+2*this.offset;this.setSize(t,e),this.setAngle(this.targetData.angle)}setLastTargetData(){this.targetData={xOffset:-this.offset,yOffset:-this.offset,width:this.target.displayWidth,height:this.target.displayHeight,angle:this.target.angle}}animate(t,e=100){this.scene.tweens.add({...t,targets:this,duration:e,ease:Phaser.Math.Easing.Sine.InOut})}}const y=t=>null==t;class x extends Phaser.GameObjects.Text{constructor({scene:t,x:i,y:s,text:a,style:h,isEditable:r=!0}){super(t,i,s,a,(t=>{const e={align:(null==t?void 0:t.align)||"left",color:(null==t?void 0:t.color)||"#000000",fontFamily:(null==t?void 0:t.fontFamily)||"Arial",fontSize:(null==t?void 0:t.fontSize)||"16px",fixedWidth:y(null==t?void 0:t.width)?100:t.width,padding:y(null==t?void 0:t.padding)?{x:2,y:2}:t.padding};return y(null==t?void 0:t.height)||(e.fixedHeight=t.height),(null==t?void 0:t.strokeColor)&&(e.stroke=t.strokeColor,e.strokeThickness=t.strokeThickness||1),e})(h)),e(this,"isEditable"),e(this,"configStyle"),this.configStyle=h,this.isEditable=r,t.add.existing(this),this.init()}init(){this.setOrigin(.5,.5)}setSize(t,e){return super.setSize(t,e),this.setFixedSize(t,e),this}}const v=class{constructor({id:t,item:i,type:s,defaultScale:a=1,canDrag:h=!0,canResize:r=!0,canRotate:o=!0}){e(this,"_item"),e(this,"type"),e(this,"selectBox"),e(this,"minDisplaySize",5),e(this,"isDragging",!1),e(this,"isSelected",!1),e(this,"canDrag",!1),e(this,"canResize",!1),e(this,"canRotate",!1),e(this,"defaultScale"),e(this,"dragOffset",{x:0,y:0}),this._item=i,this._item.setName(null!=t?t:n()),this.type=s,this.canDrag=h,this.canResize=r,this.canRotate=o,this.defaultScale=a,this.init()}get name(){return this._item.name}get x(){return this._item.x}get y(){return this._item.y}get width(){return this._item.width}get height(){return this._item.height}get displayWidth(){return this._item.displayWidth}get displayHeight(){return this._item.displayHeight}get angle(){return this._item.angle}get scale(){return this._item.scale}get scene(){return this._item.scene}init(){this._item.setOrigin(.5,.5),this.setScale(this.defaultScale),this._item.setInteractive({cursor:this.canDrag?"grab":"pointer",draggable:this.canDrag}),this.selectBox=new p(this.scene,this),this.on("pointerdown",this.handleClick,this),this.canDrag&&this.on("dragstart",this.handleDragStart,this),this.scene.events.on(h,this.handleItemSelected,this),this.scene.events.on(r,this.handleItemUnSelected,this)}setPosition(t,e,i,s){return this._item.setPosition(t,e,i,s),this.raiseBoundsChanged(),this}setDisplaySize(t,e){return this._item.setDisplaySize(t,e),this.raiseBoundsChanged(),this}setSize(t,e){return this._item.setSize(t,e),this.raiseBoundsChanged(),this}setScale(t,e){y(e)&&(e=t);const i=Phaser.Math.Snap.To(this._item.width*t,1),s=Phaser.Math.Snap.To(this._item.height*e,1);if(i<this.minDisplaySize||s<this.minDisplaySize)return this;const a=i/this._item.width,h=s/this._item.height;return this._item.setScale(a,h),this.raiseBoundsChanged(),this}resize(t,e){const i=Phaser.Math.Snap.To(t,1),s=Phaser.Math.Snap.To(e,1);return i<this.minDisplaySize||s<this.minDisplaySize?this:"text"===this.type?this.setSize(i,s):this.setDisplaySize(i,s)}setAngle(t){return this._item.setAngle(t),this.raiseBoundsChanged(),this}on(t,e,i){return this._item.on(t,e,i),this}off(t,e,i){return this._item.on(t,e,i),this}getBounds(){return this._item.getBounds()}getTopLeft(){return this._item.getTopLeft()}getTopRight(){return this._item.getTopRight()}getTopCenter(){return this._item.getTopCenter()}getLeftCenter(){return this._item.getLeftCenter()}getRightCenter(){return this._item.getRightCenter()}getBottomLeft(){return this._item.getBottomLeft()}getBottomCenter(){return this._item.getBottomCenter()}getBottomRight(){return this._item.getBottomRight()}getCenter(){return this._item.getCenter()}emit(t,...e){return this._item.emit(t,...e)}handleDragStart(t){this.isDragging=!0,this.scene.game.canvas.style.cursor="grabbing",this.off("dragstart",this.handleDragStart,this),this.animateScale(1.01*this.scale),this.dragOffset={x:this.x-t.x,y:this.y-t.y},this.on("drag",this.handleDrag,this),this.on("dragend",this.handleDragEnd,this)}handleDrag(t){const e={x:t.x+this.dragOffset.x,y:t.y+this.dragOffset.y};this.setPosition(e.x,e.y),this.scene.events.emit("ItemDragging",{x:this.x,y:this.y})}handleDragEnd(){this.scene.events.emit("ItemDropped",this),this.dragOffset={x:0,y:0},this.animateScale(.99*this.scale),this.on("dragstart",this.handleDragStart,this),this.off("drag",this.handleDrag,this),this.off("dragend",this.handleDragEnd,this),this.scene.game.canvas.style.cursor="grab"}handleClick(){this.isSelected||(this.isSelected=!0,this.scene.children.bringToTop(this._item),this.scene.events.emit(h,this))}handleItemSelected(t){this.name!==t.name&&(this.isSelected=!1)}handleItemUnSelected(){this.isSelected=!1}onResizeStarted(t,e){return this._item.on(v.Events.resizeStarted,t,e),this}offResizeStarted(t){return this._item.off(v.Events.resizeStarted,t),this}onResizeEnded(t,e){return this._item.on(v.Events.resizeEnded,t,e),this}offResizeEnded(t){return this._item.off(v.Events.resizeEnded,t),this}onRotateStarted(t,e){return this._item.on(v.Events.rotateStarted,t,e),this}offRotateStarted(t){return this._item.off(v.Events.rotateStarted,t),this}onRotateEnded(t,e){return this._item.on(v.Events.rotateEnded,t,e),this}offRotateEnded(t){return this._item.off(v.Events.rotateEnded,t),this}onBoundsChanged(t,e){return this._item.on(v.Events.boundsChanged,t,e),this}offBoundsChange(t){return this._item.off(v.Events.boundsChanged,t),this}onHover(t,e){return this._item.on("pointerover",t,e),this}offHover(t){return this._item.off("pointerover",t),this}onHoverLeave(t,e){return this._item.on("pointerout",t,e),this}offHoverLeave(t){return this._item.off("pointerout",t),this}bringToTop(){this._item.scene.children.bringToTop(this._item)}setOrigin(t,e){const i=this._item.originX,s=this._item.originY,a=(t-i)*this.displayWidth,h=(e-s)*this.displayHeight;console.log({size:{width:this.displayWidth,height:this.displayHeight},newO:{x:t,y:e},oldO:{x:i,y:s},dX:a,dY:h}),this._item.setOrigin(t,e),this._item.setPosition(this.x+a,this.y+h)}animateScale(t,e=100){this.scene.tweens.add({scale:t,targets:this,duration:e,ease:Phaser.Math.Easing.Sine.InOut,onComplete:()=>{this.raiseBoundsChanged()}})}raiseBoundsChanged(){this._item.emit(v.Events.boundsChanged,this.getBounds())}static Image({scene:t,key:e,id:i,x:s,y:a,...h}){const r=y(s)?t.game.canvas.width/2:s,o=y(a)?t.game.canvas.height/2:a,d=y(i)?`${e}-${n()}`:i;return new v({item:t.add.image(r,o,e),type:"image",id:d,...h})}static Text({scene:t,style:e,text:i,id:s,x:a,y:h,isEditable:r,...o}){const d=y(a)?t.game.canvas.width/2:a,l=y(h)?t.game.canvas.height/2:h,g=y(s)?`text-${n()}`:s;return new v({item:new x({scene:t,x:d,y:l,text:i,style:e,isEditable:r}),type:"text",id:g,...o})}};let S=v;e(S,"Events",{boundsChanged:"BOUNDS_CHANGED",rotateStarted:"ROTATE_STARTED",rotateEnded:"ROTATE_ENDED",resizeStarted:"RESIZE_STARTED",resizeEnded:"RESIZE_ENDED"});class R extends Phaser.GameObjects.Container{constructor(t){super(t),e(this,"text"),e(this,"background"),e(this,"offsetValue",50),this.setAlpha(0),t.add.existing(this),this.init()}init(){this.text=this.scene.add.text(0,0," ",{fontSize:"14px",color:d.white.rgba,align:"center",padding:{x:3,y:2.5}}).setOrigin(.5,.5),this.background=this.scene.add.rectangle(0,0,this.text.width,this.text.height,d.select.color).setOrigin(.5,.5),this.add([this.background,this.text])}show(){this.animate({alpha:1})}followPointer(){this.scene.children.bringToTop(this),this.scene.input.on("pointermove",this.setIdealPosition,this)}stopFollowingPointer(){this.scene.input.off("pointermove",this.setIdealPosition)}hide(){this.animate({alpha:0})}setText(t){this.text.setText(t),this.background.setSize(this.text.width,this.text.height)}animate(t,e=200){this.scene.tweens.add({...t,targets:this,duration:e,ease:Phaser.Math.Easing.Sine.InOut})}setIdealPosition(t){const e={x:t.x+this.offsetValue,y:t.y+this.offsetValue},{width:i,height:s}=this.scene.scale;e.x>=i-this.offsetValue&&(e.x-=2*this.offsetValue),e.y>=s-this.offsetValue&&(e.y-=2*this.offsetValue),this.setPosition(e.x,e.y)}}class w{constructor(t,i,s=0){e(this,"handle"),e(this,"offset"),e(this,"target"),e(this,"resizeInfo"),e(this,"infoOffsetValue",50),e(this,"targetData"),e(this,"resizeStartData"),e(this,"position"),this.handle=t,this.position=i,this.offset=s,this.handle.setAlpha(0),this.init()}get isTopBottom(){return"top-middle"===this.position||"bottom-middle"===this.position}get isLeftRight(){return"middle-left"===this.position||"middle-right"===this.position}init(){this.resizeInfo=new R(this.handle.scene),this.handle.setOrigin(.5,.5),this.handle.setInteractive({draggable:!0,cursor:this.resolveCursor()}),this.handle.on("pointerover",this.handleHover,this),this.handle.on("pointerout",this.handleHoverLeave,this)}setTarget(t){var e,i,s,a;this.target=t,this.isTopBottom?null==(i=(e=this.handle).setSize)||i.call(e,this.target.displayWidth/2,8):this.isLeftRight&&(null==(a=(s=this.handle).setSize)||a.call(s,8,this.target.displayHeight/2)),this.handle.setOrigin(.5,.5),this.setLastTargetData(t),this.setPositionFromTarget(),t.onBoundsChanged(this.setPositionFromTarget,this),t.onResizeStarted(this.handleResizeStartedEvent,this),t.onResizeEnded(this.show,this),t.onRotateStarted(this.hide,this),t.onRotateEnded(this.show,this),this.show(),this.handle.on("dragstart",this.handleResizeStart,this),this.handle.scene.children.bringToTop(this.handle)}clearTarget(){this.target&&(this.target.offBoundsChange(this.setPositionFromTarget),this.target.offResizeStarted(this.handleResizeStartedEvent),this.target.offResizeEnded(this.show),this.target.offRotateStarted(this.hide),this.target.offRotateEnded(this.show),this.target=null),this.targetData={xOffset:0,yOffset:0,height:0,width:0,angle:0},this.hide(),this.handle.scene.time.delayedCall(100,(()=>{this.handle.setPosition(0,0)}),null,this)}show(){this.animate({alpha:1})}hide(){this.animate({alpha:0})}handleHover(){this.animate({scale:1.05}),this.animateColor(d.select)}handleHoverLeave(){this.animate({scale:1}),this.animateColor(d.white)}handleResizeStart(t){this.target.emit(S.Events.resizeStarted,this.position),this.resizeInfo.followPointer(),this.setInfoText(),this.resizeInfo.setIdealPosition(t),this.resizeInfo.show();const e=this.resolveResizeOrigin();this.target.setOrigin(e.x,e.y),this.resizeStartData={x:t.x,y:t.y,scale:this.target.scale,width:this.target.displayWidth,height:this.target.displayHeight},this.handle.off("dragstart",this.handleResizeStart,this),this.handle.on("drag",this.handleResize,this),this.handle.on("dragend",this.handleResizeEnd,this)}handleResize(t){if(!this.target)return;const e=this.getResizeDistanceData(t);if(e.canResize){switch(this.position){case"top-left":case"top-right":case"bottom-left":case"bottom-right":this.target.resize(e.newScaledSize.width,e.newScaledSize.height);break;case"top-middle":this.target.resize(this.target.displayWidth,e.newTopHeight);break;case"bottom-middle":this.target.resize(this.target.displayWidth,e.newBottomHeight);break;case"middle-left":this.target.resize(e.newLeftWidth,this.target.displayHeight);break;case"middle-right":this.target.resize(e.newRightWidth,this.target.displayHeight)}this.setInfoText()}}handleResizeEnd(){this.target.emit(S.Events.resizeEnded,this.position),this.resizeStartData={x:0,y:0,height:0,width:0,scale:1},this.resizeInfo.stopFollowingPointer(),this.resizeInfo.hide(),this.handle.on("dragstart",this.handleResizeStart,this),this.handle.off("drag",this.handleResize,this),this.handle.off("dragend",this.handleResizeEnd,this),this.target.setOrigin(.5,.5)}handleResizeStartedEvent(t){this.position!==t&&this.hide()}setPositionFromTarget(){if(!this.target)return;const t=this.target.getCenter();l(this.targetData,{width:this.target.displayWidth,height:this.target.displayHeight})&&this.target.angle===this.targetData.angle||this.setLastTargetData(this.target),this.handle.setPosition(t.x+this.targetData.xOffset,t.y+this.targetData.yOffset)}setLastTargetData(t){let e;const i=t.getCenter();switch(this.position){case"top-left":e=t.getTopLeft(),e.x-=this.offset,e.y-=this.offset;break;case"top-middle":e=t.getTopCenter(),e.y-=this.offset;break;case"top-right":e=t.getTopRight(),e.x+=this.offset,e.y-=this.offset;break;case"middle-left":e=t.getLeftCenter(),e.x-=this.offset;break;case"middle-right":e=t.getRightCenter(),e.x+=this.offset;break;case"bottom-left":e=t.getBottomLeft(),e.x-=this.offset,e.y+=this.offset;break;case"bottom-middle":e=t.getBottomCenter(),e.y+=this.offset;break;case"bottom-right":e=t.getBottomRight(),e.x+=this.offset,e.y+=this.offset}this.targetData={width:t.displayWidth,height:t.displayHeight,xOffset:e.x-i.x,yOffset:e.y-i.y,angle:t.angle}}resolveCursor(){switch(this.position){case"top-left":case"bottom-right":return"nw-resize";case"top-right":case"bottom-left":return"ne-resize";case"top-middle":case"bottom-middle":return"n-resize";case"middle-left":case"middle-right":return"e-resize"}return"resize"}resolveResizeOrigin(){switch(this.position){case"top-middle":return{x:0,y:0};case"middle-left":return{x:1,y:0};case"middle-right":case"bottom-middle":return{x:0,y:1};default:return{x:.5,y:.5}}}animate(t,e=100){this.handle.scene.tweens.add({...t,targets:this.handle,duration:e,ease:Phaser.Math.Easing.Sine.InOut})}animateColor(t,e=100){const i=Phaser.Display.Color.ValueToColor(this.handle.fillColor);this.handle.scene.tweens.addCounter({from:0,to:100,duration:e,onUpdate:e=>{const s=e.getValue(),{r:a,g:h,b:r}=Phaser.Display.Color.Interpolate.ColorWithColor(i,t,100,s);this.handle.setFillStyle(Phaser.Display.Color.GetColor(a,h,r),1)},ease:Phaser.Math.Easing.Sine.InOut})}getResizeDistanceData(t){const e=this.resizeStartData,i=Phaser.Math.Distance.Between(this.resizeStartData.x,this.resizeStartData.y,this.target.x,this.target.y),s=Phaser.Math.Distance.Between(t.x,t.y,this.target.x,this.target.y),a=t.y-e.y,h=t.x-e.x,r=this.resizeStartData.scale*(s/i);return{canResize:!0,vertical:a,verticalAbsolute:Math.abs(a),horizontal:h,horizontalAbsolute:Math.abs(h),default:i,current:s,newScaledSize:{width:this.resizeStartData.width*r,height:this.resizeStartData.height*r},newLeftWidth:this.resizeStartData.width-h,newRightWidth:this.resizeStartData.width+h,newTopHeight:this.resizeStartData.height+a,newBottomHeight:this.resizeStartData.height-a}}setInfoText(){const t=Math.round(this.target.displayWidth).toLocaleString(),e=Math.round(this.target.displayHeight).toLocaleString();this.resizeInfo.setText(`w:${t} h:${e}`)}static Circle(t,e,i){const s=t.add.arc(0,0,6,0,360,!1,d.white.color,1);return s.setStrokeStyle(1,d.gray.color),s.setOrigin(.5,.5),new w(s,e,i)}static Ellipse(t,e,i,s){const a=t.add.ellipse(0,0,"horizontal"===e?16:8,"vertical"===e?16:8,d.white.color,1);return a.setOrigin(.5,.5),a.setStrokeStyle(1,d.gray.color),new w(a,i,s)}}class b extends Phaser.GameObjects.Image{constructor(t){super(t,0,0,"rotate-btn"),e(this,"target"),e(this,"rotateInfo"),e(this,"targetData"),e(this,"baseScale",.5),e(this,"offset",20),e(this,"infoOffsetValue",50),this.setAlpha(0),t.add.existing(this),this.init()}init(){this.setOrigin(.5,.5),this.rotateInfo=new R(this.scene),this.setScale(this.baseScale),this.setInteractive({cursor:"all-scroll",draggable:!0}).on("pointerover",this.handleHover,this).on("pointerout",this.handleHoverLeave,this)}setTarget(t){this.target=t,this.setLastTargetData(t),this.updatePosition(),t.onBoundsChanged(this.updatePosition,this),t.onResizeStarted(this.hide,this),t.onRotateStarted(this.hide,this),t.onRotateEnded(this.show,this),t.onResizeEnded(this.show,this),this.animate({alpha:1}),this.on("dragstart",this.handleRotateStart,this),this.scene.children.bringToTop(this)}clearTarget(){this.target&&(this.target.offBoundsChange(this.updatePosition),this.target=null),this.targetData={xOffset:0,yOffset:0,height:0,width:0,angle:0},this.animate({alpha:0}),this.scene.time.delayedCall(100,(()=>{this.setPosition(0,0)}),null,this)}updatePosition(){l(this.targetData,{width:this.target.displayWidth,height:this.target.displayHeight})&&this.target.angle===this.targetData.angle||this.setLastTargetData(this.target);const t=this.target.getCenter();this.setPosition(t.x+this.targetData.xOffset,t.y+this.targetData.yOffset)}setLastTargetData(t){const e=t.getBottomCenter(),i=t.getCenter(),s=e.x-i.x,a=e.y-i.y,h=Math.sqrt(s*s+a*a),r=s/h,n=a/h,o=e.x+this.offset*r,d=e.y+this.offset*n;this.targetData={xOffset:o-i.x,yOffset:d-i.y,width:t.displayWidth,height:t.displayHeight,angle:t.angle}}handleRotateStart(t){this.target.emit(S.Events.rotateStarted),this.rotateInfo.setText(`${this.target.angle}°`),this.rotateInfo.setIdealPosition(t),this.rotateInfo.followPointer(),this.rotateInfo.show(),this.off("dragstart",this.handleRotateStart,this),this.on("drag",this.handleRotate,this),this.on("dragend",this.handleRotateEnd,this)}handleRotate(t){if(!this.target)return;const e=360/(2*Math.PI)*Phaser.Math.Angle.Between(this.target.x,this.target.y,t.x,t.y)-90;let i=Phaser.Math.Snap.To(e,2);i<0&&(i+=360),360===i&&(i=0),this.target.setAngle(i),this.rotateInfo.setText(`${i}°`)}handleRotateEnd(){this.target.emit(S.Events.rotateEnded),this.rotateInfo.stopFollowingPointer(),this.rotateInfo.hide(),this.on("dragstart",this.handleRotateStart,this),this.off("drag",this.handleRotate,this),this.off("dragend",this.handleRotateEnd,this)}handleHover(){this.animate({scale:1.1*this.baseScale})}handleHoverLeave(){this.animate({scale:this.baseScale})}show(){this.animate({alpha:1})}hide(){this.animate({alpha:0})}animate(t,e=100){this.scene.tweens.add({...t,targets:this,duration:e,ease:Phaser.Math.Easing.Sine.InOut})}}class z extends Phaser.GameObjects.Group{constructor(t){super(t),e(this,"target"),e(this,"rotateBtn"),e(this,"resizeHandles",{"top-left":null,"top-middle":null,"top-right":null,"middle-left":null,"middle-right":null,"bottom-left":null,"bottom-middle":null,"bottom-right":null}),e(this,"offset",0),t.add.existing(this),this.init()}init(){this.rotateBtn=new b(this.scene),this.add(this.rotateBtn);for(let t in this.resizeHandles){const e=t;e.includes("middle")?this.resizeHandles[e]=w.Ellipse(this.scene,e.startsWith("middle")?"vertical":"horizontal",e,this.offset):this.resizeHandles[e]=w.Circle(this.scene,e,this.offset),this.add(this.resizeHandles[e].handle)}this.scene.events.on(h,this.handleSelected,this),this.scene.events.on(r,this.handleUnSelected,this)}handleSelected(t){if(this.target=t,t.canResize){const e=this.resolveResizePositions(this.target.type);for(const i in this.resizeHandles){const s=this.resizeHandles[i];e.includes(s.position)?s.setTarget(t):s.clearTarget()}}t.canRotate&&this.rotateBtn.setTarget(t)}handleUnSelected(){if(this.target){if(this.target.canResize)for(const t in this.resizeHandles)this.resizeHandles[t].clearTarget();this.target.canRotate&&this.rotateBtn.clearTarget(),this.target=null}}resolveResizePositions(t){switch(t){case"image":return["top-left","top-right","bottom-left","bottom-right"];case"text":return["middle-left","middle-right"];default:return[]}}}class T extends Phaser.Scene{constructor(){super("Play"),e(this,"background"),e(this,"sunglasses"),e(this,"text"),e(this,"itemTransformer")}get height(){return this.scale.height}get width(){return this.scale.width}get center(){return{x:this.width/2,y:this.height/2}}create(){this.background=this.add.image(0,0,"bg-woman-yelling-at-cat").setDisplaySize(this.width,this.height).setOrigin(0,0),this.sunglasses=S.Image({scene:this,key:"sunglasses"}),this.text=S.Text({scene:this,text:"Hello World!"}),this.itemTransformer=new z(this),this.input.on("pointerdown",this.tryUnSelect,this)}update(){}tryUnSelect(t,e){e.length||this.events.emit(r,t)}}const D=Phaser.Utils.Objects.GetValue;class P{constructor(t,e,i,s,a){void 0===t&&(t=0),void 0===e&&(e=t),void 0===i&&(i=0),void 0===s&&(s=0),void 0===a&&(a=0),this.cornerRadius={},this._width=0,this._height=0,this.setTo(t,e,i,s,a)}setTo(t,e,i,s,a){return this.setPosition(t,e),this.setRadius(a),this.setSize(i,s),this}setPosition(t,e){return this.x=t,this.y=e,this}setRadius(t){return void 0===t&&(t=0),this.radius=t,this}setSize(t,e){return this.width=t,this.height=e,this}get minWidth(){var t=this.cornerRadius;return Math.max(t.tl.x+t.tr.x,t.bl.x+t.br.x)}get minHeight(){var t=this.cornerRadius;return Math.max(t.tl.y+t.bl.y,t.tr.y+t.br.y)}get width(){return this._width}set width(t){null==t&&(t=0),this._width=Math.max(t,this.minWidth)}get height(){return this._height}set height(t){null==t&&(t=0),this._height=Math.max(t,this.minHeight)}get radius(){var t=this.cornerRadius;return Math.max(t.tl.x,t.tl.y,t.tr.x,t.tr.y,t.bl.x,t.bl.y,t.br.x,t.br.y)}set radius(t){var e,i;"number"==typeof t?(e=t,i=t):(e=D(t,"x",0),i=D(t,"y",0));var s=this.cornerRadius;s.tl=_(D(t,"tl",void 0),e,i),s.tr=_(D(t,"tr",void 0),e,i),s.bl=_(D(t,"bl",void 0),e,i),s.br=_(D(t,"br",void 0),e,i)}get radiusTL(){var t=this.cornerRadius.tl;return Math.max(t.x,t.y)}set radiusTL(t){C(this.cornerRadius.tl,t)}get radiusTR(){var t=this.cornerRadius.tr;return Math.max(t.x,t.y)}set radiusTR(t){C(this.cornerRadius.tr,t)}get radiusBL(){var t=this.cornerRadius.bl;return Math.max(t.x,t.y)}set radiusBL(t){C(this.cornerRadius.bl,t)}get radiusBR(){var t=this.cornerRadius.br;return Math.max(t.x,t.y)}set radiusBR(t){C(this.cornerRadius.br,t)}}var _=function(t,e,i){return void 0===t?t={x:e,y:i}:"number"==typeof t&&(t={x:t,y:t}),O(t),t},C=function(t,e){"number"==typeof e?(t.x=e,t.y=e):(t.x=D(e,"x",0),t.y=D(e,"y",0)),O(t)},O=function(t){t.convex=t.x>=0||t.y>=0,t.x=Math.abs(t.x),t.y=Math.abs(t.y)},E=function(t,e,i){var s=i.length;if(s>=2){var a=i[s-2],h=i[s-1];if(t===a&&e===h)return i}return i.push(t,e),i};const B=Phaser.Math.DegToRad;var k=function(t,e,i,s,a,h,r,n,o){r&&h>a?h-=360:!r&&h<a&&(h+=360);var d=B(h-a)/n;a=B(a);for(var l=0;l<=n;l++){var g=a+d*l,c=t+i*Math.cos(g),u=e+s*Math.sin(g);E(c,u,o)}return o},I=Phaser.Renderer.WebGL.Utils,L=Phaser.Renderer.WebGL.Utils;const H=Phaser.GameObjects.GetCalcMatrix,A=Phaser.Renderer.Canvas.SetTransform,W={renderWebGL:function(t,e,i,s){e.dirty&&(e.updateData(),e.dirty=!1),i.addToRenderList(e);var a=t.pipelines.set(e.pipeline),h=H(e,i,s),r=a.calcMatrix.copyFrom(h.calc),n=e._displayOriginX,o=e._displayOriginY,d=i.alpha*e.alpha;t.pipelines.preBatch(e),e.isFilled&&function(t,e,i,s,a,h){for(var r=I.getTintAppendFloatAlpha(i.fillColor,i.fillAlpha*s),n=i.pathData,o=i.pathIndexes,d=0;d<o.length;d+=3){var l=2*o[d],g=2*o[d+1],c=2*o[d+2],u=n[l+0]-a,f=n[l+1]-h,m=n[g+0]-a,p=n[g+1]-h,y=n[c+0]-a,x=n[c+1]-h,v=e.getX(u,f),S=e.getY(u,f),R=e.getX(m,p),w=e.getY(m,p),b=e.getX(y,x),z=e.getY(y,x);t.batchTri(i,v,S,R,w,b,z,0,0,1,1,r,r,r,2)}}(a,r,e,d,n,o),e.isStroked&&function(t,e,i,s,a){var h=t.strokeTint,r=L.getTintAppendFloatAlpha(e.strokeColor,e.strokeAlpha*i);h.TL=r,h.TR=r,h.BL=r,h.BR=r;var n=e.pathData,o=n.length-1,d=e.lineWidth,l=d/2,g=n[0]-s,c=n[1]-a;e.closePath||(o-=2);for(var u=2;u<o;u+=2){var f=n[u]-s,m=n[u+1]-a;t.batchLine(g,c,f,m,l,l,d,u-2,!!e.closePath&&u===o-1),g=f,c=m}}(a,e,d,n,o),t.pipelines.postBatch(e)},renderCanvas:function(t,e,i,s){e.dirty&&(e.updateData(),e.dirty=!1),i.addToRenderList(e);var a=t.currentContext;if(A(t,a,e,i,s)){var h=e._displayOriginX,r=e._displayOriginY,n=e.pathData,o=n.length-1,d=n[0]-h,l=n[1]-r;a.beginPath(),a.moveTo(d,l),e.closePath||(o-=2);for(var g=2;g<o;g+=2){var c=n[g]-h,u=n[g+1]-r;a.lineTo(c,u)}a.closePath(),e.isFilled&&(function(t,e,i,s){var a=e.fillColor,h=e.fillAlpha,r=(16711680&a)>>>16,n=(65280&a)>>>8,o=255&a;t.fillStyle="rgba("+r+","+n+","+o+","+h+")"}(a,e),a.fill()),e.isStroked&&(function(t,e,i,s){var a=e.strokeColor,h=e.strokeAlpha,r=(16711680&a)>>>16,n=(65280&a)>>>8,o=255&a;t.strokeStyle="rgba("+r+","+n+","+o+","+h+")",t.lineWidth=e.lineWidth}(a,e),a.stroke()),a.restore()}}},M=Phaser.GameObjects.Shape,F=Phaser.Utils.Objects.IsPlainObject,j=Phaser.Utils.Objects.GetValue,G=Phaser.Geom.Polygon.Earcut;class U extends M{constructor(t,e,i,s,a,h,r,n){var o,d,l,g;if(F(e)){var c=e;e=c.x,i=c.y,s=c.width,a=c.height,h=c.radius,r=c.color,n=c.alpha,o=c.strokeColor,d=c.strokeAlpha,l=c.strokeWidth,g=c.shape}void 0===e&&(e=0),void 0===i&&(i=0),void 0===s&&(s=1),void 0===a&&(a=s),void 0===h&&(h=0),void 0===g&&(g=0);var u=new P;if(super(t,"rexRoundRectangleShape",u),this.setShapeType(g),0===this.shapeType){var f=j(h,"radius",h);u.setTo(0,0,s,a,f)}else f={x:s/2,y:a/2},u.setTo(0,0,s,a,f);var m=j(h,"iteration",void 0);this.setIteration(m),this.setPosition(e,i),this.setFillStyle(r,n),void 0!==o&&void 0===l&&(l=2),this.setStrokeStyle(l,o,d),this.updateDisplayOrigin(),this.dirty=!0}get fillColor(){return this._fillColor}set fillColor(t){this._fillColor=t,this.isFilled=null!=t&&this._fillAlpha>0}get fillAlpha(){return this._fillAlpha}set fillAlpha(t){this._fillAlpha=t,this.isFilled=t>0&&null!=this._fillColor}setFillStyle(t,e){return void 0===e&&(e=1),this.fillColor=t,this.fillAlpha=e,this}get strokeColor(){return this._strokeColor}set strokeColor(t){this._strokeColor=t,this.isStroked=null!=t&&this._strokeAlpha>0&&this._lineWidth>0}get strokeAlpha(){return this._strokeAlpha}set strokeAlpha(t){this._strokeAlpha=t,this.isStroked=t>0&&null!=this._strokeColor&&this._lineWidth>0}get lineWidth(){return this._lineWidth}set lineWidth(t){this._lineWidth=t,this.isStroked=t>0&&null!=this._strokeColor}setStrokeStyle(t,e,i){return void 0===i&&(i=1),this.lineWidth=t,this.strokeColor=e,this.strokeAlpha=i,this}updateData(){var t=this.geom,e=this.pathData;e.length=0;var i,s=t.width,a=t.height,h=t.cornerRadius,r=this.iteration+1;if(i=h.tl,V(i))if(i.convex){var n=i.x,o=i.y;k(n,o,i.x,i.y,180,270,!1,r,e)}else k(n=0,o=0,i.x,i.y,90,0,!0,r,e);else E(0,0,e);return i=h.tr,V(i)?i.convex?(n=s-i.x,o=i.y,k(n,o,i.x,i.y,270,360,!1,r,e)):k(n=s,o=0,i.x,i.y,180,90,!0,r,e):E(s,0,e),i=h.br,V(i)?i.convex?(n=s-i.x,o=a-i.y,k(n,o,i.x,i.y,0,90,!1,r,e)):k(n=s,o=a,i.x,i.y,270,180,!0,r,e):E(s,a,e),i=h.bl,V(i)?i.convex?(n=i.x,o=a-i.y,k(n,o,i.x,i.y,90,180,!1,r,e)):k(n=0,o=a,i.x,i.y,360,270,!0,r,e):E(0,a,e),e.push(e[0],e[1]),this.pathIndexes=G(e),this}setShapeType(t){return"string"==typeof t&&(t=N[t]),this.shapeType=t,this}get width(){return this.geom.width}set width(t){this.resize(t,this.height)}get height(){return this.geom.height}set height(t){this.resize(this.width,t)}setSize(t,e){if(void 0===e&&(e=t),this.geom.width===t&&this.geom.height===e)return this;this.geom.setSize(t,e),1===this.shapeType&&this.setRadius({x:t/2,y:e/2}),this.updateDisplayOrigin(),this.dirty=!0;var i=this.input;return i&&!i.customHitArea&&(i.hitArea.width=t,i.hitArea.height=e),this}resize(t,e){return this.setSize(t,e),this}get radius(){return this.geom.radius}set radius(t){this.geom.setRadius(t),this.updateDisplayOrigin(),this.dirty=!0}get radiusTL(){return this.geom.radiusTL}set radiusTL(t){this.geom.radiusTL=t,this.dirty=!0}get radiusTR(){return this.geom.radiusTR}set radiusTR(t){this.geom.radiusTR=t,this.dirty=!0}get radiusBL(){return this.geom.radiusBL}set radiusBL(t){this.geom.radiusBL=t,this.dirty=!0}get radiusBR(){return this.geom.radiusBR}set radiusBR(t){this.geom.radiusBR=t,this.dirty=!0}setRadius(t){return void 0===t&&(t=0),this.radius=t,this}setRadiusTL(t){return void 0===t&&(t=0),this.radiusTL=t,this}setRadiusTR(t){return void 0===t&&(t=0),this.radiusTR=t,this}setRadiusBL(t){return void 0===t&&(t=0),this.radiusBL=t,this}setRadiusBR(t){return void 0===t&&(t=0),this.radiusBR=t,this}get cornerRadius(){return this.geom.cornerRadius}set cornerRadius(t){this.radius=t}setCornerRadius(t){return this.setRadius(t)}get iteration(){return this._iteration}set iteration(t){void 0!==this._iteration?this._iteration!==t&&(this._iteration=t,this.dirty=!0):this._iteration=t}setIteration(t){return void 0===t&&(t=6),this.iteration=t,this}}var V=function(t){return t.x>0&&t.y>0};const N={rectangle:0,circle:1};function $(t,e,i,s,a,h,r){var n=new U(this.scene,t,e,i,s,a,h,r);return this.scene.add.existing(n),n}Object.assign(U.prototype,W);const X=Phaser.Utils.Objects.GetAdvancedValue,Y=Phaser.Utils.Objects.GetValue,q=Phaser.GameObjects.BuildGameObject;function Z(t,e){void 0===t&&(t={}),void 0!==e&&(t.add=e);var i=X(t,"width",void 0),s=X(t,"height",i),a=Y(t,"radius",void 0),h=X(t,"fillColor",void 0),r=X(t,"fillAlpha",void 0),n=new U(this.scene,0,0,i,s,a,h,r);return q(this.scene,n,t),n}var K=function(t){return null==t||""===t||0===t.length};class J extends Phaser.Plugins.BasePlugin{constructor(t){super(t),t.registerGameObject("rexRoundRectangle",$,Z)}start(){this.game.events.on("destroy",this.destroy,this)}}!function(t,e,i,s){if(void 0===s&&(s="."),"object"==typeof t)if(K(e)){if(null==i)return;"object"==typeof i&&(t=i)}else{"string"==typeof e&&(e=e.split(s));var a=e.pop(),h=function(t,e,i){var s=t;if(K(e));else{var a;"string"==typeof e&&(e=e.split("."));for(var h=0,r=e.length;h<r;h++){var n;null!=s[a=e[h]]&&"object"==typeof s[a]||(n={},s[a]=n),s=s[a]}}return s}(t,e);h[a]=i}}(window,"RexPlugins.GameObjects.RoundRectangle",U);const Q={width:2560,height:1752},tt=g({size:Q,maxWidth:800}),et=g({size:Q,maxWidth:350}),it={type:i.AUTO,width:tt.width,height:tt.height,max:tt,min:et,parent:"game-container",pixelArt:!1,autoFocus:!0,plugins:{global:[{key:"rexRoundRectanglePlugin",plugin:J,start:!0}]},physics:{default:"arcade",arcade:{debug:!1}},scale:{mode:i.Scale.FIT,autoCenter:i.Scale.CENTER_BOTH,fullscreenTarget:"game-container",parent:"game-container"},scene:[s,a,T]};new i.Game(it);
